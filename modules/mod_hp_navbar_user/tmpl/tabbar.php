<?php

/**
 * HYPERPC - The shop of powerful computers.
 *
 * This file is part of the HYPERPC package.
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 *
 * @package     HYPERPC
 * @license     Proprietary
 * @copyright   Proprietary https://hyperpc.ru/license
 * @link        https://github.com/HYPER-PC/HYPERPC".
 *
 * @author      Artem Vyshnevskiy
 */

defined('_JEXEC') or die('Restricted access');

use Joomla\CMS\Application\SiteApplication;
use Joomla\CMS\HTML\HTMLHelper;
use Joomla\Input\Input;
use Joomla\Registry\Registry;
use HYPERPC\App;
use HYPERPC\Module\NavbarUser\Site\Helper\NavbarUserHelper;

/**
 * @var \stdClass $module
 * @var SiteApplication $app
 * @var Input $input
 * @var Registry $params
 * @var string $template
 */

$hp = App::getInstance();

$wa = $app->getDocument()->getWebAssetManager();
$wa->registerAndUseScript(
    'mod_hp_navbar_user',
    'com_hyperpc/apps/dist/modules/navbar-user.js',
    attributes:['defer' => true],
    dependencies:['vue', 'core']
);

$wa->addInlineScript('document.querySelector(\'body\').classList.add(\'tm-has-tabbar\')');

/** @var NavbarUserHelper $helper */
$helper = $app->bootModule('mod_hp_navbar_user', 'site')->getHelper('NavbarUserHelper');

$cartData = $helper->getCartData();
$userMenuData = $helper->getUserData();
$compareCount = $helper->getCompareCount();

$homePath = $helper->getHomeRoute($app);
$catalogPath = $helper->getCatalogRoute($params, $app);
$counfiguratorPath = $helper->getConfiguratorRoute($params, $app);
$cartPath = $cartData->get('cartUrl', '/cart');

?>

<nav class="jsMainTabbar tm-main-tabbar uk-position-fixed uk-position-bottom uk-position-z-index uk-flex uk-flex-between uk-hidden@s">
    <a href="<?= $homePath ?>" class="tm-main-tabbar__item<?= $helper->isActivePath($homePath) ? ' uk-active' : '' ?>">
        <span class="tm-main-tabbar__icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="29" height="24" viewBox="0 0 29 24" fill="none">
                <path d="M0 11.3315C0 11.9145 0.474244 12.419 1.23303 12.419C1.60057 12.419 1.93254 12.2284 2.22895 12.0042L3.58054 10.9279V21.3542C3.58054 23.0134 4.63573 24 6.44971 24H22.491C24.2931 24 25.3602 23.0134 25.3602 21.3542V10.8719L26.7829 12.0042C27.0675 12.2284 27.3994 12.419 27.767 12.419C28.4665 12.419 29 12.0042 29 11.354C29 10.9728 28.8459 10.6701 28.5376 10.4234L25.3602 7.88976V3.11386C25.3602 2.60937 25.0164 2.29546 24.4828 2.29546H22.8467C22.325 2.29546 21.9693 2.60937 21.9693 3.11386V5.19911L16.1954 0.613804C15.1639 -0.204601 13.8598 -0.204601 12.8283 0.613804L0.474244 10.4234C0.154129 10.6701 0 11.0064 0 11.3315ZM17.9146 14.4258C17.9146 13.8989 17.5589 13.5625 17.0016 13.5625H12.0221C11.4648 13.5625 11.0973 13.8989 11.0973 14.4258V21.769H7.07809C6.34301 21.769 5.9399 21.3766 5.9399 20.6703V9.0557L13.9902 2.66542C14.3222 2.39636 14.7016 2.39636 15.0335 2.66542L22.989 8.98844V20.6703C22.989 21.3766 22.5859 21.769 21.8508 21.769H17.9146V14.4258Z" fill="currentColor" />
            </svg>
        </span>
    </a>
    <a href="<?= $catalogPath ?>" class="tm-main-tabbar__item<?= $helper->isActivePath($catalogPath) ? ' uk-active' : '' ?>">
        <span class="tm-main-tabbar__icon">
            <svg width="26" height="24" viewBox="0 0 28 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="0.883789" width="21.4884" height="2" rx="1" fill="currentColor"></rect>
                <rect x="0.883789" y="6" width="21.4884" height="2" rx="1" fill="currentColor"></rect>
                <rect x="0.883789" y="12" width="10.7442" height="2" rx="1" fill="currentColor"></rect>
                <path d="M10.6512 13.9433C10.6512 12.988 10.8278 12.0923 11.1809 11.2564C11.5396 10.4148 12.0329 9.67553 12.6606 9.03864C13.2884 8.39605 14.0142 7.89563 14.8381 7.53738C15.6677 7.17913 16.5533 7 17.4949 7C18.4421 7 19.3277 7.17913 20.1516 7.53738C20.9812 7.89563 21.7098 8.39605 22.3376 9.03864C22.9653 9.67553 23.4557 10.4148 23.8089 11.2564C24.1676 12.0923 24.3469 12.988 24.3469 13.9433C24.3469 14.6939 24.232 15.4076 24.0022 16.0843C23.778 16.761 23.467 17.378 23.069 17.9353L26.9028 21.8419C27.0205 21.9557 27.1074 22.0893 27.1634 22.2429C27.2251 22.3964 27.2559 22.5585 27.2559 22.7291C27.2559 22.9679 27.2027 23.184 27.0962 23.3773C26.9897 23.5707 26.8439 23.7214 26.659 23.8294C26.474 23.9431 26.261 24 26.02 24C25.8519 24 25.6893 23.9687 25.5324 23.9062C25.381 23.8493 25.2437 23.7583 25.1204 23.6332L21.2614 19.718C20.7233 20.082 20.1348 20.3691 19.4958 20.5795C18.8625 20.7842 18.1955 20.8866 17.4949 20.8866C16.5533 20.8866 15.6677 20.7075 14.8381 20.3492C14.0142 19.991 13.2884 19.4934 12.6606 18.8565C12.0329 18.2196 11.5396 17.4832 11.1809 16.6473C10.8278 15.8057 10.6512 14.9043 10.6512 13.9433ZM12.442 13.9433C12.442 14.6541 12.5709 15.3195 12.8288 15.9393C13.0922 16.5591 13.4565 17.105 13.9217 17.577C14.3869 18.0433 14.925 18.4101 15.536 18.6774C16.1469 18.9446 16.7999 19.0783 17.4949 19.0783C18.1955 19.0783 18.8513 18.9446 19.4622 18.6774C20.0732 18.4101 20.6084 18.0433 21.068 17.577C21.5332 17.105 21.8976 16.5591 22.161 15.9393C22.4244 15.3195 22.5562 14.6541 22.5562 13.9433C22.5562 13.2382 22.4244 12.5757 22.161 11.9558C21.8976 11.336 21.5332 10.7901 21.068 10.3181C20.6084 9.84613 20.0732 9.47934 19.4622 9.21776C18.8513 8.95049 18.1955 8.81686 17.4949 8.81686C16.7999 8.81686 16.1469 8.95049 15.536 9.21776C14.925 9.47934 14.3869 9.84613 13.9217 10.3181C13.4565 10.7901 13.0922 11.336 12.8288 11.9558C12.5709 12.5757 12.442 13.2382 12.442 13.9433Z" fill="currentColor"></path>
                <path d="M10.6512 13.9433C10.6512 12.988 10.8278 12.0923 11.1809 11.2564C11.5396 10.4148 12.0329 9.67553 12.6606 9.03864C13.2884 8.39605 14.0142 7.89563 14.8381 7.53738C15.6677 7.17913 16.5533 7 17.4949 7C18.4421 7 19.3277 7.17913 20.1516 7.53738C20.9812 7.89563 21.7098 8.39605 22.3376 9.03864C22.9653 9.67553 23.4557 10.4148 23.8089 11.2564C24.1676 12.0923 24.3469 12.988 24.3469 13.9433C24.3469 14.6939 24.232 15.4076 24.0022 16.0843C23.778 16.761 23.467 17.378 23.069 17.9353L26.9028 21.8419C27.0205 21.9557 27.1074 22.0893 27.1634 22.2429C27.2251 22.3964 27.2559 22.5585 27.2559 22.7291C27.2559 22.9679 27.2027 23.184 27.0962 23.3773C26.9897 23.5707 26.8439 23.7214 26.659 23.8294C26.474 23.9431 26.261 24 26.02 24C25.8519 24 25.6893 23.9687 25.5324 23.9062C25.381 23.8493 25.2437 23.7583 25.1204 23.6332L21.2614 19.718C20.7233 20.082 20.1348 20.3691 19.4958 20.5795C18.8625 20.7842 18.1955 20.8866 17.4949 20.8866C16.5533 20.8866 15.6677 20.7075 14.8381 20.3492C14.0142 19.991 13.2884 19.4934 12.6606 18.8565C12.0329 18.2196 11.5396 17.4832 11.1809 16.6473C10.8278 15.8057 10.6512 14.9043 10.6512 13.9433ZM12.442 13.9433C12.442 14.6541 12.5709 15.3195 12.8288 15.9393C13.0922 16.5591 13.4565 17.105 13.9217 17.577C14.3869 18.0433 14.925 18.4101 15.536 18.6774C16.1469 18.9446 16.7999 19.0783 17.4949 19.0783C18.1955 19.0783 18.8513 18.9446 19.4622 18.6774C20.0732 18.4101 20.6084 18.0433 21.068 17.577C21.5332 17.105 21.8976 16.5591 22.161 15.9393C22.4244 15.3195 22.5562 14.6541 22.5562 13.9433C22.5562 13.2382 22.4244 12.5757 22.161 11.9558C21.8976 11.336 21.5332 10.7901 21.068 10.3181C20.6084 9.84613 20.0732 9.47934 19.4622 9.21776C18.8513 8.95049 18.1955 8.81686 17.4949 8.81686C16.7999 8.81686 16.1469 8.95049 15.536 9.21776C14.925 9.47934 14.3869 9.84613 13.9217 10.3181C13.4565 10.7901 13.0922 11.336 12.8288 11.9558C12.5709 12.5757 12.442 13.2382 12.442 13.9433Z"></path>
            </svg>
        </span>
    </a>
    <a href="<?= $counfiguratorPath ?>" class="tm-main-tabbar__item<?= $helper->isActivePath($counfiguratorPath) ? ' uk-active' : '' ?>">
        <span class="tm-main-tabbar__icon">
            <svg width="24" height="23" viewBox="0 0 24 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1.7299 21.6316C3.51101 23.3426 5.92251 23.3329 7.63357 21.651C9.17452 20.1441 9.6148 18.2969 12.1264 15.079L16.1489 18.9677L16.2789 19.8233C16.339 20.2024 16.5891 20.5427 16.9093 20.7566L20.0813 22.8274C20.4415 23.0607 20.8017 23.0607 21.0619 22.8079L22.9731 20.951C23.2232 20.6983 23.2032 20.3385 22.9731 19.9983L20.8618 16.9261C20.6316 16.5956 20.2814 16.372 19.8912 16.3136L19.0206 16.1873L14.768 12.0554C15.1382 11.6763 15.5285 11.2777 15.9587 10.8596C18.1101 11.7832 20.6717 11.4332 22.3727 9.77076C24.2439 7.96247 24.5341 5.08477 23.0732 2.80983L21.9324 3.91813V3.92785L20.3214 5.47365C20.0713 5.72642 19.7611 5.73614 19.5009 5.47365L18.3802 4.38479C18.1001 4.11257 18.0901 3.81119 18.3402 3.56814L19.9412 2.01262L21.0919 0.90432C18.7605 -0.515088 15.8086 -0.242873 13.9375 1.57514C12.4666 3.01399 11.9863 5.0556 12.4966 6.93194L7.01318 1.58486C5.53226 0.146006 3.94128 0.136284 2.49038 1.54597L1.0795 2.92649C-0.3714 4.32645 -0.361394 5.87225 1.11952 7.3111L6.713 12.7457C4.43158 14.1845 2.97067 14.6804 1.70989 15.8859C-0.0211831 17.5581 -0.0311893 19.8913 1.7299 21.6316ZM17.1695 5.2306L18.6204 6.63056C19.3709 7.35971 20.3314 7.37915 21.0419 6.68889L22.3927 5.3667C22.5628 6.59167 22.1726 7.81664 21.262 8.70134C19.631 10.286 16.9293 10.2082 15.1983 8.54579C13.4772 6.87361 13.4072 4.22923 15.0482 2.65427C15.9487 1.7793 17.2095 1.40014 18.4603 1.55569L17.1094 2.85844C16.369 3.57786 16.399 4.50145 17.1695 5.2306ZM2.19019 6.1153C1.48975 5.43476 1.49976 4.75422 2.18018 4.0834L3.68111 2.60566C4.37154 1.93485 5.08198 1.94457 5.78242 2.62511L11.9563 8.62356C10.4553 10.0138 9.16452 11.0443 8.04382 11.8415L2.19019 6.1153ZM8.29398 7.95275C8.46408 8.13747 8.77428 8.11802 8.93437 7.96247C9.12449 7.77775 9.12449 7.49582 8.94438 7.32082L5.30212 3.79175C5.12201 3.61675 4.84183 3.62647 4.67173 3.79175C4.49162 3.96674 4.49162 4.23896 4.67173 4.41395L8.29398 7.95275ZM7.02319 9.17772C7.2033 9.36243 7.49348 9.35271 7.67359 9.17772C7.8437 9.01244 7.8537 8.74023 7.67359 8.56523L4.03133 5.02644C3.87123 4.86116 3.57105 4.86116 3.39093 5.02644C3.21082 5.20143 3.20082 5.49309 3.38093 5.65836L7.02319 9.17772ZM14.0876 9.6152C14.2677 9.78048 14.4478 9.94575 14.6379 10.0819C8.06384 16.6539 8.74426 18.2969 6.46284 20.5233C5.42219 21.5441 4.00131 21.583 2.89062 20.5135C1.77993 19.415 1.82997 18.0442 2.87061 17.0331C5.16203 14.8165 6.84308 15.4776 13.6073 9.09022C13.7574 9.27494 13.9175 9.44993 14.0876 9.6152ZM17.97 19.3858L17.7599 18.2969L13.157 13.8248C13.3171 13.6304 13.4872 13.4457 13.6673 13.2415L18.3202 17.7622L19.4409 17.9469L21.282 20.3191L20.4015 21.1746L17.97 19.3858ZM4.65172 19.9691C5.30212 19.9691 5.83245 19.4538 5.83245 18.8122C5.83245 18.1803 5.30212 17.665 4.65172 17.665C4.00131 17.665 3.46098 18.1803 3.46098 18.8122C3.46098 19.4538 4.00131 19.9691 4.65172 19.9691Z" fill="currentColor" />
            </svg>
        </span>
    </a>
    <a href="<?= $cartPath ?>" class="tm-main-tabbar__item<?= $helper->isActivePath($cartPath) ? ' uk-active' : '' ?>">
        <span class="tm-main-tabbar__icon">
            <svg width="26" height="22" viewBox="0 0 26 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.14028 16.4614H22.1627C22.6885 16.4614 23.1695 16.0532 23.1695 15.4684C23.1695 14.8947 22.6885 14.4865 22.1627 14.4865H9.39759C8.86059 14.4865 8.52496 14.1224 8.44664 13.5597L8.27883 12.4122H22.2522C23.9639 12.4122 24.8701 11.3862 25.1162 9.70913L25.9552 4.18154C25.9776 4.03811 26 3.85055 26 3.72919C26 3.07823 25.5413 2.63691 24.7694 2.63691H6.83563L6.66781 1.44534C6.52238 0.485456 6.13081 0 4.88898 0H1.05164C0.492255 0 0 0.485456 0 1.04814C0 1.62187 0.492255 2.10732 1.05164 2.10732H4.55336L6.28744 13.7803C6.53356 15.4463 7.42857 16.4614 9.14028 16.4614ZM23.673 4.61184L22.9682 9.51053C22.8787 10.0732 22.5766 10.4263 22.0284 10.4263L7.98795 10.4373L7.12651 4.61184H23.673ZM10.0577 22C11.1429 22 12.0155 21.1394 12.0155 20.0692C12.0155 18.999 11.1429 18.1384 10.0577 18.1384C8.97246 18.1384 8.09983 18.999 8.09983 20.0692C8.09983 21.1394 8.97246 22 10.0577 22ZM20.395 22C21.4802 22 22.3417 21.1394 22.3417 20.0692C22.3417 18.999 21.4802 18.1384 20.395 18.1384C19.3098 18.1384 18.426 18.999 18.426 20.0692C18.426 21.1394 19.3098 22 20.395 22Z" fill="currentColor" />
            </svg>
        </span>
        <span class="jsCartBadge" data-props='{"count": <?= count($cartData->get('cartItems', [])) ?>}' hidden></span>
    </a>
    <?php if ($params->get('chat_in_tabbar', 0)) :
        $modalContent = $params->get('chat_modal_content', []);
        ?>
        <span class="tm-main-tabbar__divider"></span>
        <a href="#tabbar-chat-content" class="tm-main-tabbar__item" data-uk-toggle>
            <svg width="30" height="24" viewBox="0 0 30 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7.01087 22.7461C7.59171 22.7461 8.10122 22.4974 8.80435 21.8756L12.0754 18.9119C12.8295 19.7098 13.9606 20.1347 15.377 20.1347H18.8621L22.2554 23.0984C22.928 23.6788 23.4069 24 23.9572 24C24.7724 24 25.2514 23.4093 25.2514 22.5078V20.1347H25.7201C28.288 20.1347 30 18.5389 30 15.8549V9.52332C30 6.79793 28.2575 5.16062 25.6386 5.16062H23.8655V4.48705C23.8655 1.66839 22.1637 0 19.3716 0H4.49389C1.78329 0 0 1.66839 0 4.48705V14.1865C0 16.9637 1.75272 18.6114 4.41236 18.6114H5.69633V21.2642C5.69633 22.1762 6.18546 22.7461 7.01087 22.7461ZM7.52038 17.5959C7.52038 16.9741 7.14334 16.6529 6.63383 16.6529H4.73845C3.04688 16.6529 2.02785 15.6891 2.02785 13.8964V4.71503C2.02785 2.92228 3.05707 1.94819 4.73845 1.94819H19.1168C20.8084 1.94819 21.8274 2.92228 21.8274 4.71503V5.16062H15.377C12.6664 5.16062 11.0156 6.79793 11.0156 9.52332V15.8549C11.0156 16.2902 11.0564 16.6839 11.1379 17.057L7.52038 20.4974V17.5959ZM23.4375 21.7513L20.248 18.8083C19.7996 18.3938 19.4226 18.2073 18.8213 18.2073H15.591C13.9912 18.2073 13.0231 17.3057 13.0231 15.5855V9.72021C13.0231 8.02073 13.9912 7.09845 15.591 7.09845H25.4144C27.0245 7.09845 27.9925 8.02073 27.9925 9.72021V15.5855C27.9925 17.2953 27.0143 18.2073 25.4144 18.2073H24.3139C23.8145 18.2073 23.4375 18.5181 23.4375 19.1399V21.7513Z" fill="currentColor"/>
            </svg>
            <span id="tabbar-chat-notification" hidden></span>
        </a>
        <?= HTMLHelper::_('content.prepare', $hp['helper']['string']->filterLanguage($modalContent)) ?>
    <?php else :
        $profileMenuPath = $helper->getProfileMenuRoute();
        ?>
        <a href="<?= $profileMenuPath ?>" class="tm-main-tabbar__item<?= $helper->isActivePath($profileMenuPath) ? ' uk-active' : '' ?>">
            <span class="tm-main-tabbar__icon">
                <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11.5065 11.5554C14.6708 11.5554 17.2337 8.92188 17.2337 5.6977C17.2337 2.52274 14.6708 0 11.5065 0C8.35532 0 5.76634 2.55966 5.77942 5.72231C5.7925 8.93419 8.34224 11.5554 11.5065 11.5554ZM11.5065 9.40182C9.7021 9.40182 8.17226 7.78973 8.17226 5.72231C8.15918 3.70412 9.68903 2.15356 11.5065 2.15356C13.3371 2.15356 14.8408 3.67951 14.8408 5.6977C14.8408 7.76512 13.324 9.40182 11.5065 9.40182ZM3.34736 23H19.6526C21.9147 23 23 22.3232 23 20.8711C23 17.4869 18.5151 12.9829 11.5065 12.9829C4.49801 12.9829 0 17.4869 0 20.8711C0 22.3232 1.08528 23 3.34736 23ZM2.94201 20.8464C2.6282 20.8464 2.51052 20.748 2.51052 20.5265C2.51052 18.6437 5.74019 15.1364 11.5065 15.1364C17.2598 15.1364 20.4895 18.6437 20.4895 20.5265C20.4895 20.748 20.3718 20.8464 20.058 20.8464H2.94201Z" fill="currentColor" />
                </svg>
            </span>
            <span class="jsCompareBadge" data-props='{"count": <?= $compareCount ?>}' hidden></span>
        </a>
    <?php endif; ?>
</nav>
